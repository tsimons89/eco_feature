#include <opencv2/opencv.hpp>
#include <opencv2/core/cuda.hpp>
#include "Eco_filter.hpp"
#include "Eco_file_access.hpp"
#include <ctime>

using namespace std;

#define CALC_TIME(F,s) clock_t begin##s = clock();F; clock_t end##s = clock();cout << "Cycles " << s << ": " << end##s - begin##s << endl;

int main(int argc, char * argv[]){
	vector<Eco_filter> filters = Eco_file_access::get_filters_from_file("test.yaml");
	Eco_filter sobel = filters.at(1);
<<<<<<< HEAD
	Eco_filter der = filters.at(2);
	orig.apply(sobel);
	orig.apply(box);
	orig.apply(sobel);
	orig.apply(box);


	cuda::GpuMat image_gpu = Eco_file_access::get_gpu_image(argv[1]);

	clock_t begin, end;

	begin = clock();
	cuda::GpuMat combo_gpu = orig.apply(image_gpu);
	end = clock();
	cout << "Combo time: " << end - begin << endl;

	begin = clock();
	combo_gpu = orig.apply(image_gpu);
	end = clock();
	cout << "Combo time: " << end - begin << endl;


	begin = clock();
	cuda::GpuMat multi_gpu = box.apply(sobel.apply(box.apply(sobel.apply(image_gpu))));
	end = clock();
	cout << "Multi time: " << end - begin << endl;

	begin = clock();
	multi_gpu = box.apply(sobel.apply(box.apply(sobel.apply(image_gpu))));
	end = clock();
	cout << "Multi time: " << end - begin << endl;

	Mat image = Eco_file_access::get_image(argv[1]);

	begin = clock();
	Mat combo_cpu = orig.apply(image);
	end = clock();
	cout << "Cpu combo time: " << end - begin << endl;



	begin = clock();
	Mat multi_image = box.apply(sobel.apply(box.apply(sobel.apply(image))));
	end = clock();
	cout << "Cpu multi time: " << end - begin << endl;

	Mat cpu_test = image;

	begin = clock();
	Sobel(cpu_test,cpu_test,-1,1,0);
	boxFilter(cpu_test,cpu_test,-1,Size(5,5),Point(-1,-1),false);
	Sobel(cpu_test,cpu_test,-1,1,0);
	boxFilter(cpu_test,cpu_test,-1,Size(5,5),Point(-1,-1),false);
	end = clock();
	cout << "Cpu cv time: " << end - begin << endl;

	cuda::GpuMat gpu_test = image_gpu; 
	gpu_test.convertTo(gpu_test,CV_8UC1);
	Ptr<cuda::Filter> box_filter = cuda::createBoxFilter(gpu_test.type(),gpu_test.type(),Size(5,5));
	Ptr<cuda::Filter> sobel_filter = cuda::createSobelFilter(gpu_test.type(),gpu_test.type(),1,0);

	begin = clock();
	sobel_filter->apply(gpu_test,gpu_test);	
	box_filter->apply(gpu_test,gpu_test);
	sobel_filter->apply(gpu_test,gpu_test);	
	box_filter->apply(gpu_test,gpu_test);
	end = clock();
	cout << "Gpu cv time: " << end - begin << endl;


	waitKey(0);
}
=======

	Mat image = Eco_file_access::get_image(argv[1]);
	cuda::GpuMat gpu_image = Eco_file_access::get_gpu_image(argv[1]);
	CALC_TIME(sobel.apply(image),1)
	CALC_TIME(sobel.apply(image),2)
	CALC_TIME(sobel.apply(gpu_image),3)
	CALC_TIME(sobel.apply(gpu_image),4)
	CALC_TIME(Sobel(image,image,-1,1,0),5)
	CALC_TIME(Sobel(image,image,-1,0,1),6)

}
>>>>>>> c1af34af4248eb6d259b3312c75044b45553472c
